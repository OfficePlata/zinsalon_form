<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登録フォームへリダイレクト中...</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: sans-serif;
            background-color: #f4f4f9;
            color: #333;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #00B900; /* LINE Green */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div>
        <div class="loader" style="margin: 0 auto;"></div>
        <p>情報を読み込んでいます...</p>
    </div>

<script>
    // --- ① 基本設定 ---
    const LIFF_ID = "1657635807-gXxYBOwN";
    const LARK_FORM_BASE_URL = "https://bjplm1vnnisz.jp.larksuite.com/share/base/form/shrjpiAsEEC22pRkQmPYGrHygP3";

    // --- ② Larkフォームのパラメータ設定 ---
    // ★重要：Larkの仕様に合わせて、ここの名前を調整する必要があるかもしれません。
    // Larkフォームの「LINEユーザーID」という項目に対応するパラメータ名
    const PARAM_NAME_FOR_USER_ID = "prefill_LINEユーザーID";
    // Larkフォームの「LINE表示名」という項目に対応するパラメータ名
    const PARAM_NAME_FOR_DISPLAY_NAME = "prefill_LINE表示名";
    // --- 設定はここまで ---


    async function main() {
        try {
            await liff.init({ liffId: LIFF_ID });

            if (!liff.isLoggedIn()) {
                liff.login();
                return; // ログイン後、このページが再読み込みされる
            }

            // LINEのプロフィール情報を取得
            const profile = await liff.getProfile();
            const userId = profile.userId;
            const displayName = profile.displayName;

            // Larkフォームに渡すためのURLを作成
            const params = new URLSearchParams();
            params.append(PARAM_NAME_FOR_USER_ID, userId);
            params.append(PARAM_NAME_FOR_DISPLAY_NAME, displayName);
            
            const redirectUrl = `${LARK_FORM_BASE_URL}?${params.toString()}`;

            // 作成したURLにリダイレクト
            window.location.href = redirectUrl;

        } catch (error) {
            console.error("Error during LIFF processing:", error);
            document.body.innerHTML = "エラーが発生しました。LIFFアプリを再度開いてください。";
        }
    }

    main();
</script>
</body>
</html>
